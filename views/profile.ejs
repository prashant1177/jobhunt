<% layout('./layout/boilerplate.ejs') -%>

<section class="container my-5">
  <% if (userDetails) { %>
  <h1 class="mb-4"><%= userDetails.name %> - Profile</h1>

  <!-- Basic Info -->
  <div class="card p-3 mb-4">
    <h4>Basic Information</h4>
    <p><strong>Email:</strong> <%= userDetails.email %></p>
    <p>
      <strong>Location:</strong> <%= userDetails.location || "Not specified" %>
    </p>
    <p><strong>Bio:</strong> <%= userDetails.bio || "No bio available" %></p>
  </div>

  <!-- Skills -->
  <div class="card p-3 mb-4">
    <h4>Skills</h4>
    <% if (userDetails.skills && userDetails.skills.length) { %>
    <ul>
      <% userDetails.skills.forEach(skill => { %>
      <li><%= skill %></li>
      <% }) %>
    </ul>
    <% } else { %>
    <p>No skills listed</p>
    <% } %>
  </div>

  <!-- Education -->
  <div class="card p-3 mb-4">
    <h4>Education</h4>
    <% if (userDetails.education) { %>
    <p><strong>Degree:</strong> <%= userDetails.education.degree %></p>
    <p>
      <strong>Institution:</strong> <%= userDetails.education.institution %>
    </p>
    <p>
      <strong>Year of Passing:</strong> <%= userDetails.education.yearOfPassing
      %>
    </p>
    <p><strong>CGPA:</strong> <%= userDetails.education.cgpa %></p>
    <% } else { %>
    <p>No education details available</p>
    <% } %>
  </div>

  <!-- Experience -->
  <div class="card p-3 mb-4">
    <h4>Experience</h4>
    <% if (userDetails.experience && userDetails.experience.length) { %> <%
    userDetails.experience.forEach(exp => { %>
    <div class="mb-3">
      <p><strong>Company:</strong> <%= exp.company %></p>
      <p><strong>Role:</strong> <%= exp.jobrole %></p>
      <p>
        <strong>Duration:</strong>
        <%= exp.startDate.toDateString() %> - <%= exp.endDate ?
        exp.endDate.toDateString() : "Present" %>
      </p>
      <p><strong>Description:</strong> <%= exp.description || "N/A" %></p>
    </div>
    <hr />
    <% }) %> <% } else { %>
    <p>No work experience added</p>
    <% } %>
  </div>

  <!-- Projects -->
  <div class="card p-3 mb-4">
    <h4>Projects</h4>
    <% if (userDetails.projects && userDetails.projects.length) { %> <%
    userDetails.projects.forEach(project => { %>
    <div class="mb-3">
      <p><strong>Title:</strong> <%= project.title %></p>
      <p><strong>Description:</strong> <%= project.description || "N/A" %></p>
      <% if (project.techStack && project.techStack.length) { %>
      <p><strong>Tech Stack:</strong> <%= project.techStack.join(", ") %></p>
      <% } %> <% if (project.link) { %>
      <p><a href="<%= project.link %>" target="_blank">View Project</a></p>
      <% } %>
    </div>
    <hr />
    <% }) %> <% } else { %>
    <p>No projects listed</p>
    <% } %>
  </div>

  <!-- Applications Made -->
  <div class="card p-3 mb-4">
    <h4>Applications Made</h4>
    <% if (applications && applications.length) { %>
    <ul>
      <% applications.forEach(app => { %>
      <li>
        Applied to: <strong><%= app.job.title %></strong> at <%= app.job.company
        %>
      </li>
      <% }) %>
    </ul>
    <% } else { %>
    <p>No applications found</p>
    <% } %>
  </div>

  <!-- Jobs Posted & Applications -->
  <div class="card p-3 mb-4">
    <h4>Jobs Posted & Their Applications</h4>
    <% if (jobApplications && jobApplications.length) { %> <%
    jobApplications.forEach(jobApp => { %>
    <div class="mb-4">
      <h5>Job: <%= jobApp.job.title %></h5>
      <% if (jobApp.applications && jobApp.applications.length) { %>
      <ul>
        <% jobApp.applications.forEach(a => { %>
        <li>
          Applicant: <strong><%= a.applicant.name %></strong> - <%=
          a.applicant.email %>
        </li>
        <% }) %>
      </ul>
      <% } else { %>
      <p>No applications for this job yet</p>
      <% } %>
    </div>
    <hr />
    <% }) %> <% } else { %>
    <p>No jobs posted</p>
    <% } %>
  </div>
  <% } else { %>
  <p>User not found or not logged in</p>
  <% } %>
</section>
